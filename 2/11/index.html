<!-- 
/*
 * 
 *                  xxxxxxx      xxxxxxx
 *                   x:::::x    x:::::x 
 *                    x:::::x  x:::::x  
 *                     x:::::xx:::::x   
 *                      x::::::::::x    
 *                       x::::::::x     
 *                       x::::::::x     
 *                      x::::::::::x    
 *                     x:::::xx:::::x   
 *                    x:::::x  x:::::x  
 *                   x:::::x    x:::::x 
 *              THE xxxxxxx      xxxxxxx TOOLKIT
 *                    
 *                  http://www.goXTK.com
 *                   
 * Copyright (c) 2012 The X Toolkit Developers <dev@goXTK.com>
 *                   
 *    The X Toolkit (XTK) is licensed under the MIT License:
 *      http://www.opensource.org/licenses/mit-license.php
 *
 * LESSON 11 - Slice some colors!
 *
 * Here we load a dicom volume in .nrrd format and also a labelmap overlay in .nrrd format.
 * In addition, a color table (look-up table) gets parsed which then maps the label values to colors.
 *
 * The color table is the 'Slicer Generic Anatomy Colors' which is bundled with 3D Slicer (http://slicer.org).
 */
-->

<html>
<head>
<title>XTK LESSON 11</title>

<!-- <script type="text/javascript" src="xtk.js"></script> -->
<script type="text/javascript" src="../../../X/lib/closure-library/closure/goog/base.js"></script>
<script type="text/javascript" src="../../../X/xtk-deps.js"></script>
<script type="text/javascript" src="http://get.goXTK.com/xtk_xdat.gui.js"></script>

<script type="text/javascript">

  goog.require('X.renderer2D');
  goog.require('X.volume');

  var run = function() {
    
    var r = new X.renderer2D('r','X');
    r.init();
    renX = r;
    var r2 = new X.renderer2D('r2','Y');
    r2.init();
    var r3 = new X.renderer2D('r3','Z');
    r3.init();    
    
    var volume = new X.volume();
    volume.load('vol.nrrd');
    
    r.add(volume);
    
    r.render();
    
    
    r.onShowtime = function() { 
      
      r2.add(volume);
      r2.render();
      r3.add(volume);
      r3.render();
      
      //
      // The GUI panel
      //
      // (we need to create this during onShowtime(..) since we do not know the volume
      // dimensions before the loading was completed)
      
      var modelWasLoaded = false;
      
      var gui = new dat.GUI();
      var volumegui = gui.addFolder('Volume');
      // .. we can threshold
      var lowerThresholdController = volumegui.add(volume, '_lowerThreshold', volume.scalarRange()[0], volume.scalarRange()[1]);
      var upperThresholdController = volumegui.add(volume, '_upperThreshold', volume.scalarRange()[0], volume.scalarRange()[1]);
      var sliceXController = volumegui.add(volume, '_indexX', 0, volume.dimensions()[0]-1).listen();
      var sliceYController = volumegui.add(volume, '_indexY', 0, volume.dimensions()[1]-1).listen();
      var sliceZController = volumegui.add(volume, '_indexZ', 0, volume.dimensions()[2]-1).listen();
      volumegui.open();      
      
      
      lowerThresholdController.onChange(function(value){
        volume.modified();
        r.render();
        r2.render();
        r3.render();        
      });
      upperThresholdController.onChange(function(value){
        volume.modified();
        r.render();
        r2.render();
        r3.render();
      });     
      sliceXController.onChange(function(value) {
        volume.modified();
        r.render();
        r2.render();
        r3.render();        
      });
      sliceYController.onChange(function(value) {
        volume.modified();
        r.render();
        r2.render();
        r3.render();        
      });          
      sliceZController.onChange(function(value) {
        volume.modified();
        r.render();
        r2.render();
        r3.render();        
      });                          
      
    };
    
    
  };
</script>

<body onload="run()" style="margin:0px;">
  
  <!-- the container for the renderer -->
  <div id="r" style="background-color: #000; width: 30%; height: 30%;float:left;margin-right:10px;"></div>
  <div id="r2" style="background-color: #000; width: 30%; height: 30%;float:left;margin-right:10px;"></div>
  <div id="r3" style="background-color: #000; width: 30%; height: 30%;float:left;"></div>
    
</body>