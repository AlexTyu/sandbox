<!-- 
/*
 * 
 *                  xxxxxxx      xxxxxxx
 *                   x:::::x    x:::::x 
 *                    x:::::x  x:::::x  
 *                     x:::::xx:::::x   
 *                      x::::::::::x    
 *                       x::::::::x     
 *                       x::::::::x     
 *                      x::::::::::x    
 *                     x:::::xx:::::x   
 *                    x:::::x  x:::::x  
 *                   x:::::x    x:::::x 
 *              THE xxxxxxx      xxxxxxx TOOLKIT
 *                    
 *                  http://www.goXTK.com
 *                   
 * Copyright (c) 2012 The X Toolkit Developers <dev@goXTK.com>
 *                   
 *    The X Toolkit (XTK) is licensed under the MIT License:
 *      http://www.opensource.org/licenses/mit-license.php
 *
 * LESSON 10 - Slice it!
 *
 * The rendered vessel is an arteriovenous fistula in an arm (a bypass created by joining
 * an artery and vein) acquired from a MR scanner. The data was provided by Orobix S.R.L.
 *
 *    http://www.orobix.com  
 *
 */
-->

<html>
<head>
<title>XTK LESSON 10</title>

<!-- <script type="text/javascript" src="http://get.goxtk.com/xtk_edge.js"></script> -->
<script type="text/javascript" src="xtk.js"></script>
<!-- <script type="text/javascript" src="../../X/lib/closure-library/closure/goog/base.js"></script> -->
<!-- <script type="text/javascript" src="../../X/xtk-deps.js"></script> -->
<script type="text/javascript" src="http://get.goxtk.com/xtk_xdat.gui.js"></script>

<script type="text/javascript">

//   goog.require('X.renderer');
//   goog.require('X.object');

  var run = function() {
    
    var r = new X.renderer('r');
    r.init();
    
    model = new X.object();
    model.setColor(0.5,0.5,0.5);
    model.load('lh.smoothwm.fsm');
    model.setScalars('lh.smoothwm.C.crv');
    model.scalars()['_minColor'] = [0,0,1];
    model.scalars()['_maxColor'] = [1,1,1];
    
    r.add(model);
    
    r.render();
    
    gui = null;
    r.onShowtime = function() {
      
        if (gui) {
          
          gui.destroy();
          gui = null;
          
        }
      
      //
      // The GUI panel
      //
      var Loader = function() {
        
        this.H = function() {
          
          var oldMinColor = model.scalars()['_minColor'];
          var oldMaxColor = model.scalars()['_maxColor'];
          
          model.setScalars('lh.smoothwm.H.crv');
          model.modified();
          
          model.scalars()['_minColor'] = oldMinColor;
          model.scalars()['_maxColor'] = oldMaxColor;
          
          r.render();
        }
        
        this.C = function() {
          
          var oldMinColor = model.scalars()['_minColor'];
          var oldMaxColor = model.scalars()['_maxColor'];          
          
          model.setScalars('lh.smoothwm.C.crv');
          model.modified();
          
          model.scalars()['_minColor'] = oldMinColor;
          model.scalars()['_maxColor'] = oldMaxColor;          
          
          r.render();
        }
        
        this.K1 = function() {
          
          var oldMinColor = model.scalars()['_minColor'];
          var oldMaxColor = model.scalars()['_maxColor'];                    
          
          model.setScalars('lh.smoothwm.K1.crv');
          model.modified();

          model.scalars()['_minColor'] = oldMinColor;
          model.scalars()['_maxColor'] = oldMaxColor;          
                    
          r.render();
        }
                
                
        
      }

      var _loader = new Loader();
      
      gui = new dat.GUI();
      var curvgui = gui.addFolder('Curvature');
      // ,, switch between slicing and volume rendering
      var controller = curvgui.add(_loader,'H');
      var controller = curvgui.add(_loader,'C');
      var controller = curvgui.add(_loader,'K1');
      var minColorController = curvgui.addColor(model.scalars(), '_minColor');
      var maxColorController = curvgui.addColor(model.scalars(), '_maxColor');
      var minThresholdController = curvgui.add(model.scalars(), '_minThreshold', model.scalars().min(), model.scalars().max());
      var maxThresholdController = curvgui.add(model.scalars(), '_maxThreshold', model.scalars().min(), model.scalars().max());
      curvgui.open();
      
      minColorController.onChange(function(value) {
        r.render();
      });              

      maxColorController.onChange(function(value) {
        r.render();
      });                    
      
      minThresholdController.onChange(function(value) {
        r.render();
      });              

      maxThresholdController.onChange(function(value) {
        r.render();
      });                    
      
      
      
    };
    
    
  };
</script>

<body onload="run()" style="margin:0px;">
  
  <!-- the container for the renderer -->
  <div id="r" style="background-color: #000; width: 100%; height: 100%;"></div>
    
</body>